<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Force Calibration Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 10px; background-color: #f8f9fa; color: #333; margin: 0; }
        .container { max-width: 100%; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .header-area { text-align: center; margin-bottom: 15px; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        h2 { color: #007bff; font-size: 1.25rem; margin: 0; }
        .creator-tag { color: #adb5bd; font-size: 0.8rem; font-weight: bold; margin-top: 5px; display: block; }
        
        .section { margin-bottom: 15px; padding: 12px; border: 1px solid #e9ecef; border-radius: 10px; background: #fff; }
        .section-title { font-weight: bold; font-size: 0.95rem; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        
        input, select { width: 100%; height: 35px; padding: 5px 8px; border: 1px solid #ced4da; border-radius: 5px; font-size: 15px; box-sizing: border-box; }
        
        .table-wrapper { overflow-x: auto; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; min-width: 280px; }
        th, td { border: 1px solid #dee2e6; padding: 6px 4px; text-align: center; font-size: 0.85rem; }
        th { background: #f1f3f5; }
        
        .btn-calc { width: 100%; padding: 15px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-share { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-top: 10px; display: none; }
        .btn-reset { padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.75rem; }
        .btn-reset-sub { background: #6c757d; }
        
        #capture-area { background: white; padding: 10px; border-radius: 8px; }
        .result-item { padding: 12px; margin-bottom: 8px; border-left: 5px solid #28a745; background: #f4faf6; border-radius: 6px; font-size: 0.88rem; line-height: 1.5; }
        .error-text { font-weight: bold; font-size: 1.1rem; }
        
        .info-section { display: none; margin-top: 15px; padding-top: 10px; border-top: 1px dashed #ced4da; }
        .info-group { margin-bottom: 8px; }
        .info-group label { display: block; font-size: 0.8rem; font-weight: bold; color: #666; margin-bottom: 3px; }

        .conv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 5px; }
        .conv-box label { font-size: 0.7rem; display: block; margin-bottom: 2px; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <h2>FORCE CALIBRATION CALCULATOR</h2>
        <span class="creator-tag">Created by D</span>
    </div>

    <div class="section">
        <div class="section-title">
            <span>1Îã®Í≥Ñ Í∏∞Ï§ÄÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï</span>
            <button class="btn-reset" onclick="resetTable('cal-table')">Ï¥àÍ∏∞Ìôî</button>
        </div>
        <div style="margin-bottom: 8px;">
            <select id="ref-unit-sel">
                <option value="kn">kN (ÌÇ¨Î°úÎâ¥ÌÑ¥)</option>
                <option value="n">N (Îâ¥ÌÑ¥)</option>
            </select>
        </div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th width="30">#</th><th>ÌïòÏ§ë</th><th>Í∏∞Ï§Ä ÏÉÅÏàò</th></tr></thead>
                <tbody id="cal-table"></tbody>
            </table>
        </div>
    </div>

    <div class="section">
        <div class="section-title">
            <span>2Îã®Í≥Ñ Ï∏°Ï†ïÍ∞í ÏûÖÎ†•</span>
            <button class="btn-reset" onclick="resetTable('input-rows')">Ï¥àÍ∏∞Ìôî</button>
        </div>
        <div style="margin-bottom: 10px;">
            <select id="global-unit-sel">
                <option value="kgf">kgf</option><option value="gf">gf</option>
                <option value="kn">kN</option><option value="n">N</option>
                <option value="lbf">lbf (ibf)</option>
            </select>
        </div>
        <table>
            <thead><tr><th width="30">#</th><th>Ï∏°Ï†ïÍ∞í (Input)</th><th>Í∏∞Ï§ÄÍ∏∞ ÏÉÅÏàò (Ref)</th></tr></thead>
            <tbody id="input-rows"></tbody>
        </table>
        <button class="btn-calc" onclick="calculateAll()">Í≥ÑÏÇ∞</button>
    </div>

    <div id="capture-area">
        <div id="result-area"></div>
        <div id="info-section" class="info-section">
            <div class="info-group"><label>ÏóÖÏ≤¥Î™Ö</label><input type="text" id="company-name" placeholder="ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></div>
            <div class="info-group"><label>Ï†úÏ°∞ÏÇ¨</label><input type="text" id="manufacturer" placeholder="ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></div>
            <div class="info-group"><label>S/N</label><input type="text" id="serial-number" placeholder="ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></div>
        </div>
    </div>

    <button id="share-btn" class="btn-share" onclick="shareAsImage()">Í≤∞Í≥º Í≥µÏú† (Ïù¥ÎØ∏ÏßÄÎ°ú Ï†ÄÏû•)</button>

    <div class="section" style="border-style: dashed; background: #fafafa; margin-top: 20px;">
        <div class="section-title">
            <span>üîÑ Îã®ÏúÑ Î≥ÄÌôò Í≥ÑÏÇ∞Í∏∞</span>
            <button class="btn-reset btn-reset-sub" onclick="resetConverter()">Ï¥àÍ∏∞Ìôî</button>
        </div>
        <div class="conv-grid">
            <div><label>kgf</label><input type="number" id="c-kgf" oninput="convertUnits('kgf')"></div>
            <div><label>gf</label><input type="number" id="c-gf" oninput="convertUnits('gf')"></div>
            <div><label>kN</label><input type="number" id="c-kn" oninput="convertUnits('kn')"></div>
            <div><label>N</label><input type="number" id="c-n" oninput="convertUnits('n')"></div>
        </div>
    </div>
</div>

<script>
    const convFactors = { kn: 1, n: 1000, kgf: 101.9716, gf: 101971.6, lbf: 224.8089 };
    const calTable = document.getElementById('cal-table');
    const inputRows = document.getElementById('input-rows');
    
    for(let i=0; i<5; i++) calTable.innerHTML += `<tr><td>${i+1}</td><td><input type="number" class="kn-val"></td><td><input type="number" class="const-val"></td></tr>`;
    for(let i=0; i<5; i++) inputRows.innerHTML += `<tr><td>${i+1}</td><td><input type="number" class="comp-val"></td><td><input type="number" class="ref-const"></td></tr>`;

    function resetTable(id) { document.querySelectorAll(`#${id} input`).forEach(i => i.value = ''); }
    function resetConverter() { document.querySelectorAll('.conv-grid input').forEach(i => i.value = ''); }

    function calculateAll() {
        const refUnit = document.getElementById('ref-unit-sel').value;
        const knT = Array.from(document.querySelectorAll('.kn-val')).map(i => {
            let v = parseFloat(i.value); return refUnit === 'n' ? v / 1000 : v;
        });
        const csT = Array.from(document.querySelectorAll('.const-val')).map(i => parseFloat(i.value));
        const unit = document.getElementById('global-unit-sel').value;
        const resA = document.getElementById('result-area');

        resA.innerHTML = '<span class="section-title" style="margin-top:10px;">Í≤∞Í≥º</span>';
        const displayUnit = (unit === 'gf' || unit === 'n') ? 'N' : 'kN';
        const factor = displayUnit === 'N' ? convFactors.n : convFactors.kn;

        let hasResult = false;
        document.querySelectorAll('#input-rows tr').forEach((row, idx) => {
            const val = parseFloat(row.querySelector('.comp-val').value);
            const ref = parseFloat(row.querySelector('.ref-const').value);
            if (isNaN(val) || isNaN(ref)) return;

            let bI = 0, mD = Math.abs(csT[0] - ref);
            for(let j=1; j<knT.length; j++) {
                if (isNaN(csT[j])) continue;
                let d = Math.abs(csT[j] - ref); if(d < mD) { mD = d; bI = j; }
            }
            if (!knT[bI]) return;

            const tableKN = knT[bI];
            const tableConstant = csT[bI];
            const slope = tableConstant / tableKN;
            const valInDisplayUnit = (val / convFactors[unit]) * factor;
            const refInDisplayUnit = (ref / slope) * factor;
            const errP = ((valInDisplayUnit - refInDisplayUnit) / refInDisplayUnit) * 100;
            const sign = errP >= 0 ? "+" : "";
            hasResult = true;

            // ÏÜåÏàòÏ†ê 3ÏûêÎ¶¨(.toFixed(3)) Ï†ÅÏö©
            resA.innerHTML += `
                <div class="result-item">
                    <strong>Ï∏°Ï†ï${idx+1}</strong> | <span class="error-text" style="color:${errP>=0?'#007bff':'#d93025'}">${sign}${errP.toFixed(3)}%</span><br>
                    <span>Ï∏°Ï†ïÍ∞í ${valInDisplayUnit.toFixed(3)}${displayUnit} Í∏∞Ï§ÄÍ∞í ${refInDisplayUnit.toFixed(3)}${displayUnit} (Ï∞∏Í≥† ÏÉÅÏàòÍ∞í ${tableConstant})</span>
                </div>`;
        });

        if(hasResult) {
            document.getElementById('info-section').style.display = 'block';
            document.getElementById('share-btn').style.display = 'block';
            window.scrollTo({ top: resA.offsetTop - 20, behavior: 'smooth' });
        }
    }

    function convertUnits(type) {
        const v = parseFloat(document.getElementById('c-' + type).value);
        if (isNaN(v)) return;
        const kn = v / convFactors[type];
        for (let u in convFactors) if (u !== type && document.getElementById('c-' + u)) document.getElementById('c-' + u).value = (kn * convFactors[u]).toFixed(3);
    }

    async function shareAsImage() {
        const captureArea = document.getElementById('capture-area');
        const inputs = captureArea.querySelectorAll('input');
        const tempSpans = [];
        inputs.forEach(input => {
            const span = document.createElement('span');
            span.innerText = input.value || '(ÎØ∏ÏûÖÎ†•)';
            span.style.cssText = 'font-size:15px; font-weight:bold; color:#333;';
            input.style.display = 'none';
            input.parentNode.appendChild(span);
            tempSpans.push({ input, span });
        });

        try {
            const canvas = await html2canvas(captureArea, { backgroundColor: "#ffffff", scale: 2 });
            const dataUrl = canvas.toDataURL("image/png");
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = `Result_${new Date().getTime()}.png`;
            link.click();
            alert("Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§. Ïπ¥Ïπ¥Ïò§ÌÜ°ÏúºÎ°ú Í≥µÏú†ÌïòÏÑ∏Ïöî!");
        } catch (err) { alert("Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§."); } 
        finally { tempSpans.forEach(({ input, span }) => { input.style.display = 'block'; span.remove(); }); }
    }
</script>
</body>
</html>
